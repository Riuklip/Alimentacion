<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de GestiÃ³n de AlimentaciÃ³n</title>
    <link rel="stylesheet" href="dist/style.css">
    <script src="dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ½ï¸ Sistema de GestiÃ³n de AlimentaciÃ³n</h1>
            <p>Control de dietas y compras para trabajadores - Compatibilidad Excel Completa</p>
        </header>
        
        <div class="file-controls">
            <button id="download-template-btn" class="btn-excel">ğŸ“¥ Descargar Plantillas Excel</button>
            <button id="import-workers-excel-btn" class="btn-excel">ğŸ“ Importar Trabajadores (Excel)</button>
            <button id="import-foods-excel-btn" class="btn-excel">ğŸ“ Importar Alimentos (Excel)</button>
            <button id="export-excel-btn" class="btn-excel">ğŸ’¾ Exportar Todo a Excel</button>
            <button id="export-resumen-pedidos-btn" class="btn-excel">ğŸ¢ Resumen Pedidos Empresa</button>
            <button id="apply-stimulus-btn" class="btn-info">ğŸ’° Aplicar EstÃ­mulo a Todos</button>
            <button id="backup-btn" class="btn-info">ğŸ’¾ Exportar Backup</button>
        </div>
        
        <!-- Input oculto para importar archivos -->
        <input type="file" id="import-file" accept=".xlsx, .xls" style="display: none;">
        
        <div id="status-message" class="status-message" style="display: none;"></div>
        <div id="auto-save-indicator" class="auto-save-indicator" style="display: none;">ğŸ’¾ Guardando automÃ¡ticamente...</div>
        
        <div class="tabs">
            <div class="tab active" data-tab="workers">ğŸ‘¥ Trabajadores</div>
            <div class="tab" data-tab="foods">ğŸ Alimentos</div>
            <div class="tab" data-tab="summary">ğŸ“Š Resumen</div>
            <div class="tab" data-tab="excel">ğŸ“ˆ Reportes Excel</div>
        </div>
        
        <div class="tab-content active" id="workers-tab">
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ‘¥ GestiÃ³n de Trabajadores</h2>
                    <button id="add-worker-btn" class="btn-success">â• AÃ±adir Trabajador</button>
                </div>
                
                <div class="table-container">
                    <table id="workers-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Apellidos</th>
                                <th>Tipo de AlimentaciÃ³n</th>
                                <th>DÃ­as Totales</th>
                                <th>Meriendas Totales</th>
                                <th>Presupuesto Diario/EstÃ­mulo</th>
                                <th>Presupuesto Total</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="workers-list">
                            <!-- Los trabajadores se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="card" id="worker-details" style="display: none;">
                <div class="card-header">
                    <h2>ğŸ‘¤ Detalles del Trabajador</h2>
                </div>
                
                <div id="worker-info">
                    <!-- InformaciÃ³n del trabajador seleccionado -->
                </div>
                
                <h3>ğŸ›’ GestiÃ³n de Alimentos</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="food-select">Seleccionar Alimento:</label>
                        <select id="food-select">
                            <!-- Los alimentos se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="food-quantity">Cantidad:</label>
                        <input type="number" id="food-quantity" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <button id="add-food-btn" class="btn-success">â• AÃ±adir Alimento</button>
                    </div>
                </div>
                
                <h3>ğŸ“‹ Lista de Compra</h3>
                <div class="table-container">
                    <table id="food-list-table">
                        <thead>
                            <tr>
                                <th>Alimento</th>
                                <th>Cantidad</th>
                                <th>Precio Unitario</th>
                                <th>Subtotal</th>
                                <th>Tienda</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="food-list">
                            <!-- Los alimentos del trabajador se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="3">Total de Alimentos</td>
                                <td id="food-total">0.00 $</td>
                                <td colspan="2"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div class="summary">
                    <div class="summary-item">
                        <div>ğŸ’° Presupuesto Total</div>
                        <div class="summary-value" id="budget-total">0.00 $</div>
                    </div>
                    <div class="summary-item">
                        <div>ğŸ›’ Gasto en Alimentos</div>
                        <div class="summary-value" id="food-expense">0.00 $</div>
                    </div>
                    <div class="summary-item">
                        <div>ğŸ’µ Saldo Restante</div>
                        <div class="summary-value" id="remaining-budget">0.00 $</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="foods-tab">
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ GestiÃ³n de Alimentos</h2>
                    <button id="add-food-catalog-btn" class="btn-success">â• AÃ±adir Alimento</button>
                </div>
                
                <div class="table-container">
                    <table id="foods-catalog-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Precio</th>
                                <th>Tienda</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="foods-catalog-list">
                            <!-- Los alimentos del catÃ¡logo se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="summary-tab">
            <div class="card">
                <h2>ğŸ“Š Resumen General</h2>
                <div class="summary">
                    <div class="summary-item">
                        <div>ğŸ‘¥ Total Trabajadores</div>
                        <div class="summary-value" id="total-workers">0</div>
                    </div>
                    <div class="summary-item">
                        <div>ğŸ’° Presupuesto Total</div>
                        <div class="summary-value" id="total-budget">0.00 $</div>
                    </div>
                    <div class="summary-item">
                        <div>ğŸ›’ Gasto Total en Alimentos</div>
                        <div class="summary-value" id="total-food-expense">0.00 $</div>
                    </div>
                    <div class="summary-item">
                        <div>ğŸ’µ Saldo Total Restante</div>
                        <div class="summary-value" id="total-remaining">0.00 $</div>
                    </div>
                </div>
                
                <h3>ğŸ“ˆ Desglose por Trabajador</h3>
                <div class="table-container">
                    <table id="summary-table">
                        <thead>
                            <tr>
                                <th rowspan="2">Trabajador</th>
                                <th colspan="3">Detalles del Trabajador</th>
                                <th colspan="4">Detalles de Alimentos</th>
                            </tr>
                            <tr>
                                <th>DÃ­as Trabajados</th>
                                <th>Presupuesto Total</th>
                                <th>Saldo Restante</th>
                                <th>Alimento</th>
                                <th>Cantidad</th>
                                <th>Subtotal</th>
                                <th>Tienda</th>
                            </tr>
                        </thead>
                        <tbody id="summary-list">
                            <!-- El resumen por trabajador se cargarÃ¡ aquÃ­ dinÃ¡micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="excel-tab">
            <div class="card">
                <h2>ğŸ“ˆ Reportes y Exportaciones Excel</h2>
                
                <div class="excel-features">
                    <div class="feature-card">
                        <h3>ğŸ“¥ Importar desde Excel</h3>
                        <p>Importa tus datos directamente desde archivos Excel (.xlsx)</p>
                        <div class="feature-buttons">
                            <button class="btn-excel import-excel-btn" data-type="workers">
                                ğŸ“ Importar Trabajadores
                            </button>
                            <button class="btn-excel import-excel-btn" data-type="foods">
                                ğŸ“ Importar Alimentos
                            </button>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <h3>ğŸ’¾ Exportar a Excel</h3>
                        <p>Exporta todos los datos en formato Excel profesional</p>
                        <div class="feature-buttons">
                            <button class="btn-excel" id="export-full-excel-btn">
                                ğŸ“Š Exportar Reporte Completo
                            </button>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <h3>ğŸ§¾ Facturas por Empresa</h3>
                        <p>Exporta facturas especÃ­ficas para cada empresa</p>
                        <div class="feature-buttons">
                            <button class="btn-excel" id="export-factura-general-btn">
                                ğŸ§¾ Factura General
                            </button>
                            <button class="btn-excel" id="export-factura-kaniki-btn">
                                ğŸ›’ Factura Kaniki
                            </button>
                            <button class="btn-excel" id="export-factura-puntabrava-btn">
                                ğŸ›’ Factura Punta Brava
                            </button>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <h3>ğŸ“„ Listas de Productos</h3>
                        <p>Descarga listas de productos por tienda</p>
                        <div class="feature-buttons">
                            <button class="btn-excel" id="export-caniki-excel-btn">
                                ğŸ›’ Productos Caniki
                            </button>
                            <button class="btn-excel" id="export-puntabrava-excel-btn">
                                ğŸ›’ Productos Punta Brava
                            </button>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <h3>ğŸ¢ Resumen para la Empresa</h3>
                        <p>Exporta un resumen completo de los pedidos realizados</p>
                        <div class="feature-buttons">
                            <button class="btn-excel" id="export-resumen-pedidos-btn2">
                                ğŸ¢ Resumen Completo de Pedidos
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="excel-instructions">
                    <h3>ğŸ“‹ Instrucciones para Excel:</h3>
                    <ol>
                        <li><strong>Para importar:</strong> Usa los botones "Importar desde Excel"</li>
                        <li><strong>Para exportar:</strong> Usa los botones de exportaciÃ³n correspondientes</li>
                        <li><strong>Formatos especÃ­ficos:</strong> Cada botÃ³n genera un formato especÃ­fico</li>
                        <li><strong>Compatible con:</strong> Microsoft Excel 2007+ (.xlsx) y Google Sheets</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para aÃ±adir/editar trabajador MODIFICADO con meriendas por empresa -->
    <div id="worker-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="worker-modal-title">â• AÃ±adir Trabajador</h2>
                <span class="close">&times;</span>
            </div>
            <form id="worker-form">
                <input type="hidden" id="worker-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="worker-name">Nombre:</label>
                        <input type="text" id="worker-name" required>
                    </div>
                    <div class="form-group">
                        <label for="worker-surname">Apellidos:</label>
                        <input type="text" id="worker-surname" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="worker-diet">Tipo de AlimentaciÃ³n:</label>
                    <select id="worker-diet" required>
                        <option value="normal">Normal (400$/dÃ­a)</option>
                        <option value="mejorada">Mejorada (500$/dÃ­a)</option>
                        <option value="estimulo">EstÃ­mulo (Saldo fijo)</option>
                    </select>
                </div>
                
                <!-- Campos para dÃ­as por empresa (solo para normal/mejorada) -->
                <div class="form-row" id="days-fields">
                    <div class="form-group">
                        <label for="kaniki-days">DÃ­as en Kaniki:</label>
                        <input type="number" id="kaniki-days" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label for="puntabrava-days">DÃ­as en Punta Brava:</label>
                        <input type="number" id="puntabrava-days" min="0" value="0" required>
                    </div>
                </div>
                
                <!-- Campos para meriendas por empresa (solo para normal/mejorada) -->
                <div class="form-row" id="meriendas-fields">
                    <div class="form-group">
                        <label for="worker-snacks-kaniki">Meriendas en Kaniki:</label>
                        <input type="number" id="worker-snacks-kaniki" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label for="worker-snacks-puntabrava">Meriendas en Punta Brava:</label>
                        <input type="number" id="worker-snacks-puntabrava" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label for="snack-price">Precio por Merienda ($):</label>
                        <input type="number" id="snack-price" min="0" step="0.01" value="50" required>
                    </div>
                </div>
                
                <!-- Campo para estÃ­mulo (solo para tipo estÃ­mulo) -->
                <div class="form-row" id="stimulus-field" style="display: none;">
                    <div class="form-group">
                        <label for="stimulus-balance">Saldo del EstÃ­mulo ($):</label>
                        <input type="number" id="stimulus-balance" min="0" step="0.01" value="0" required>
                    </div>
                </div>
                
                <button type="submit" class="btn-success">ğŸ’¾ Guardar Trabajador</button>
            </form>
        </div>
    </div>
    
    <!-- Modal para aÃ±adir/editar alimento al catÃ¡logo -->
    <div id="food-catalog-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="food-catalog-modal-title">â• AÃ±adir Alimento al CatÃ¡logo</h2>
                <span class="close">&times;</span>
            </div>
            <form id="food-catalog-form">
                <input type="hidden" id="food-catalog-id">
                <div class="form-group">
                    <label for="food-catalog-name">Nombre del Alimento:</label>
                    <input type="text" id="food-catalog-name" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="food-catalog-price">Precio ($):</label>
                        <input type="number" id="food-catalog-price" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="food-catalog-store">Tienda:</label>
                        <select id="food-catalog-store" required>
                            <option value="kaniki">Kaniki</option>
                            <option value="punta_brava">Punta Brava</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn-success">ğŸ’¾ Guardar Alimento</button>
            </form>
        </div>
    </div>

    <script src="dist/app.js"></script>
</body>
</html>